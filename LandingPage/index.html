<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jitsi Video + Jamulus Audio Hub</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        body { font-family: sans-serif; margin: 0; padding: 20px; background-color: #f4f4f9; }
        h1, h2 { color: #333; }
        .instructions { padding: 20px; border: 1px solid #ddd; background: #fff; border-radius: 8px; margin-bottom: 30px; }
        .alert { color: #cc0000; font-weight: bold; }
        /* Style for the room selection area */
        #room-selection { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
            padding: 15px; 
            background: #e9e9f4; 
            border-radius: 4px;
        }
        #room-name-input { padding: 10px; flex-grow: 1; border: 1px solid #ccc; border-radius: 4px; }
        #join-button { padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        #join-button:hover { background-color: #0056b3; }
        /* Jitsi container styles */
        #jitsi-container { width: 100%; height: 80vh; border-radius: 8px; overflow: hidden; }
        /* Initial state is hidden */
        #jitsi-container.hidden { display: none; } 
    </style>
    <script src='https://video.trussal.com/external_api.js'></script>
</head>
<body>

    <h1>ðŸŽ§ Jam Session Hub (Video & Audio Separation) ðŸ“¹</h1>
    <p>Use the form below to create a video room, then connect to our dedicated low-latency Jamulus server for audio.</p>
    
    <hr>

    <h2>1. Start/Join Video Feed (Jitsi)</h2>
    <div id="room-selection">
        <input type="text" id="room-name-input" placeholder="Enter a Unique Room Name (e.g., CoolBandSession)" required>
        <button id="join-button">Join/Create Room</button>
    </div>

    <div id="jitsi-container" class="hidden"></div>
    
    <hr>

    <div class="instructions">
        <h2>2. Connect Audio (Jamulus)</h2>
        <p class="alert">
            ðŸš¨ **IMPORTANT:** Use the separate **Jamulus Client** application for low-latency audio.
            The microphone in the video feed above is **muted** to prevent echo and poor sound quality.
        </p>
        <p>1. **Download and install** the Jamulus Client.</p>
        <p>2. In the Jamulus Client, connect directly to our server:</p>
        <pre>Server Address: <strong>jamulus.trussal.com</strong></pre>
        <p>3. Ensure you have selected the correct ASIO/low-latency driver in your Jamulus settings.</p>
    </div>

    <script>
        document.getElementById('join-button').addEventListener('click', function() {
            const roomNameInput = document.getElementById('room-name-input');
            const roomName = roomNameInput.value.trim();

            if (roomName && typeof JitsiMeetExternalAPI !== 'undefined') {
                // Hide selection UI and show Jitsi container
                document.getElementById('room-selection').style.display = 'none';
                document.getElementById('jitsi-container').classList.remove('hidden');

                const domain = 'video.trussal.com';
                
                const options = {
                    roomName: roomName, // Uses the user's input
                    parentNode: document.querySelector('#jitsi-container'),
                    
                    // --- CORRECTED CONFIGURATION FOR VIDEO ON / AUDIO MUTE ---
                    configOverwrite: { 
                        // FORCE MUTE: Ensures mic is off regardless of browser cache
                        startWithAudioMuted: true, 
                        
                        // FORCE VIDEO ON: Ensures camera is active
                        startWithVideoMuted: false, 
                        
                        // AUDIO DISABLING BEST PRACTICES for External Audio
                        disableAP: true,      // Disable Audio Processing (AEC, AGC, etc.)
                        disableAEC: true,     
                        disableNS: true,
                        
                        // REMOVE CONFLICTING SETTING: 
                        // Ensure 'startAudioOnly: true' is NOT present here
                    },
                    interfaceConfigOverwrite: {
                        // VISUAL HINTS: Hide the mic button on the pre-join lobby
                        hiddenPremeetingButtons: ['microphone'],
                        // Optionally hide the mic button from the main toolbar entirely 
                        // (You would need a complete list of default toolbar buttons here)
                    }
                };

                // Create the Jitsi video feed
                new JitsiMeetExternalAPI(domain, options);
                
            } else if (!roomName) {
                alert('Please enter a room name before joining.');
            } else {
                alert('Jitsi API is still loading. Please try again in a moment.');
            }
        });
    </script>

</body>
</html>